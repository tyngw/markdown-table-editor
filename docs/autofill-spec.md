# オートフィル機能仕様

## 概要

Excelライクなオートフィル機能を実装し、セルの右下隅のフィルハンドルをドラッグすることで、パターンに基づいた自動入力を可能にします。

## 機能詳細

### フィルハンドル

- 選択範囲の右下セルに8x8pxの小さな正方形のハンドルを表示
- ハンドルの色: `--vscode-focusBorder`（デフォルト: #007ACC）
- カーソル: `crosshair`
- ホバー時に1.2倍に拡大

### ドラッグ操作

1. フィルハンドルをマウスダウン
2. ドラッグ中、マウス位置のセルまでの範囲をハイライト表示
3. マウスアップでオートフィルを実行

### パターン認識

以下の優先順位でパターンを検出：

1. **曜日パターン**
   - 日本語: 日、月、火、水、木、金、土
   - 英語: Sunday, Monday, Tuesday...
   - 英語短縮: Sun, Mon, Tue...

2. **月パターン**
   - 日本語: 1月、2月、3月...
   - 英語: January, February, March...
   - 英語短縮: Jan, Feb, Mar...

3. **日付パターン**（最優先：数値パターンより前に判定）
   - 年あり形式: YYYY/MM/DD、YYYY-MM-DD
   - 日本語形式: YYYY年M月D日、YYYY年MM月DD日
   - 年なし形式: M/D、MM/DD（現在の年を使用）
   - 元の形式を保持（年なしは年なしのまま、ゼロパディングも保持）
   - 月をまたぐ日付も自動補完（1/31 → 2/1、2025年1月31日 → 2025年2月1日）
   - 日数の差分が一定の場合に検出

4. **数値の連続**
   - 整数: 1, 2, 3...
   - 小数: 1.5, 2.0, 2.5...
   - 差分が一定の場合に検出

5. **テキスト内の数値**
   - Item 1, Item 2, Item 3...
   - Test-A-5, Test-A-6, Test-A-7...
   - File001, File002, File003...（ゼロパディング保持）
   - 複数の数値がある場合は最後に出現する数値を対象
   - 2024年1月, 2024年2月, 2024年3月...

6. **コピー**
   - パターンが検出されない場合、選択範囲の値を繰り返しコピー

### 対応方向

- 縦方向（上下）
- 横方向（左右）

### UI/UX

- フィル範囲は破線の枠線でハイライト表示
- 背景色: `--vscode-list-inactiveSelectionBackground`
- ドラッグ中はグローバルマウスイベントを監視
- ドラッグ終了時に一括でセルを更新

## 実装ファイル

### 新規作成

- `webview-react/src/hooks/useAutofill.ts` - オートフィルのロジック
- `webview-react/src/utils/autofillPatterns.ts` - パターン認識と値生成
- `webview-react/src/__tests__/autofillPatterns.test.ts` - ユニットテスト

### 変更

- `webview-react/src/components/TableEditor.tsx` - useAutofillフックの統合
- `webview-react/src/components/TableBody.tsx` - フィルハンドルの表示
- `webview-react/src/index.css` - スタイル追加

## テスト

### ユニットテスト

```bash
cd webview-react && npm test -- autofillPatterns.test.ts
```

### 手動テスト

1. 数値の連続: 1, 2, 3を選択してドラッグ → 4, 5, 6...
2. 曜日: 月, 火を選択してドラッグ → 水, 木, 金...
3. 月: 1月, 2月を選択してドラッグ → 3月, 4月, 5月...
4. 日付（年あり）: 2024/01/01, 2024/01/02を選択してドラッグ → 2024/01/03, 2024/01/04...
5. 日付（年なし）: 1/29, 1/30を選択してドラッグ → 1/31, 2/1...
6. 日付（日本語）: 2025年1月1日, 2025年1月2日を選択してドラッグ → 2025年1月3日, 2025年1月4日...
7. テキスト内の数値: Item 1, Item 2を選択してドラッグ → Item 3, Item 4...
8. 複数の数値: Test-2-A-5, Test-2-A-6を選択してドラッグ → Test-2-A-7, Test-2-A-8...
9. ゼロパディング: File001, File002を選択してドラッグ → File003, File004...
10. 複雑なケース: R-B-Web-013-001, R-B-Web-013-002を選択してドラッグ → R-B-Web-013-003, R-B-Web-013-004...
11. ゼロパディング桁上がり: File099を選択してドラッグ → File100, File101...
12. コピー: パターンが検出されない文字列を選択してドラッグ → 同じ値が繰り返される

## 制限事項

- 複数行×複数列の範囲選択からのオートフィルは未対応（単一行または単一列のみ）
- 複雑な数式や関数は未対応
- カスタムリストは未対応

## 今後の拡張案

- カスタムリストの登録機能
- 複数行×複数列の範囲からのオートフィル
- 右クリックメニューからのオートフィルオプション選択
- オートフィル後のスマートタグ表示（コピー/連続データ/書式のみコピーなど）
