# UI/UX仕様詳細

## テーブルヘッダーのスクロール仕様

### 目的
テーブルのヘッダー行（th）が縦スクロール時も常に上部に固定表示されることで、可読性・操作性を向上させる。

### 仕様
- テーブルのヘッダー行（th）はスクロールしてもテーブル上部に固定表示される（stickyヘッダー）。
- 行番号セルやヘッダーコーナーセルも同様にスクロール時に固定される。

### 注意点
- sticky指定には親要素のoverflow設定に注意する。
- z-indexの重なり順に注意し、ヘッダー・行番号・コーナーセルが正しく重なるよう調整する。

## セル・ヘッダー編集のUI/UX仕様

### 編集開始・確定・キャンセルのトリガー
- セル編集開始: セルをダブルクリック、または選択後にEnter/F2。
- 編集確定:
  - Enter: 編集確定＆同列の次行へ（セル）／編集確定（ヘッダー）
  - Shift+Enter: 改行（セルのみ、textarea時）
  - Ctrl+Enter/Cmd+Enter: 編集確定＆編集終了
  - Tab/Shift+Tab: 編集確定＆次/前のセル・ヘッダーへ
  - Escape: 編集確定＆編集終了（ヘッダーはキャンセル）
  - blur（フォーカス喪失）: 編集確定（IME入力中は除外）

### IME（日本語入力）対応
- IME入力中（compositionstart～compositionend）や確定直後（50ms間）はEnter等による編集確定を無効化。
- IME確定直後のEnterはセル確定とならず、入力が継続される。
- IME状態は `state.isComposing`/`state.imeJustEnded` で管理。

### 編集UIの仕様
- セル編集は常にtextarea、ヘッダー編集はinput[type=text]。
- 編集用input/textareaは親セル/ヘッダーのフォント・色・サイズ・幅・高さに合わせてスタイリング。
- 高さ自動調整（auto-resize）は、テキスト行数・他セル高さ・最小高さを考慮し、優先順位で決定。
- 編集開始時はinput/textareaに即フォーカス。セルは末尾にカーソル移動、ヘッダーは全選択。

### 編集状態管理・排他制御
- 編集中は `state.currentEditingCell` で管理（row=-1はヘッダー、row>=0はセル）。
- 編集中に他セル/ヘッダーを編集しようとした場合は、既存の編集を確定させてから新規編集を開始。
- 編集中セル・ヘッダーには`.editing`クラスを付与。

### データ更新・バリデーション
- 編集確定時、値が変化した場合のみVSCode側に即時反映。
- セル内容は最大10000文字まで。null/undefinedは不可。
- `displayData`と`tableData`両方を同期。

### 編集不可セル・競合時の扱い（今後拡張用）
- 行番号列や特定条件下のセルは編集不可とする場合がある。
- 編集中に外部からデータが更新された場合の競合解決は今後の課題。

---
この仕様は `webview/js/cell-editor.js` の実装に基づきます。詳細なキーボード操作仕様は `docs/keyboard-shortcuts.md` も参照してください。

### 目的
Markdown Table Editor のデータセル（.data-cell, .editable-cell）の縦位置揃えを統一し、編集前・編集中ともに「上揃え（vertical-align: top）」とする。

### 背景
- これまでデータセルは「編集前：縦中央揃え」「編集中：上揃え」となっていた。
- 表示の一貫性・可読性向上のため、常に上揃えに統一する。
- ヘッダーセル（th）や行番号セルには影響を与えないこと。

### 仕様
- `.table-editor td.data-cell` および `.table-editor td.editable-cell` に `vertical-align: top !important;` を指定する。
- 編集状態（`.editing`）の有無にかかわらず、常に上揃えとなる。
- ヘッダーセル（`.table-editor th`）や行番号セル（`.table-editor td.row-number`）の縦位置指定は従来通り維持する。

### 備考
- 既存の中央揃え指定は削除または上書きすること。
- レイアウト崩れや副作用がないか、UI全体で確認すること。
