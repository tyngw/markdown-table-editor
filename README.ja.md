# Markdown Table Editor（日本語）

VS Code拡張機能：Markdownテーブルをスプレッドシートのようなインターフェースで編集できます。

## 🚀 クイック開発セットアップ

**この拡張機能を開発中？** HTML/CSS/JSの変更で`vsce package`サイクルをスキップ：

```bash
npm run setup:webview   # 初回のみ: webview-react の依存関係をインストール
npm run dev:webview     # Vite 開発サーバー（ホットリロード付き）を起動
# ターミナルに表示された URL（例: http://localhost:5173/）を開く
# webview-react/src/**/* を編集すると即座に反映されます
```

> 💡 パッケージ化の前に `npm run build-webview` を実行して最新のWebviewバンドルを取り込みましょう。

## 主な機能

- **スプレッドシート風インターフェース**：グリッド表示でMarkdownテーブルを直感的に編集。ヘッダーや行番号は常に表示。
- **高度なセル編集**：自動で1行/複数行入力を切り替え、セルサイズに合わせて入力欄が調整。
- **HTML改行タグ対応**：`<br/>`タグを自動で改行に変換し、自然な編集体験。
- **Excel風ナビゲーション**：
  - 矢印キーでセル間移動
  - **Ctrl+矢印キー**でデータ境界までジャンプ
  - **Enter**でセル編集開始または次の行へ
  - **Shift+Enter**で編集中に改行
  - **Tab**で次のセルへ
- **高度なコピー/ペースト**：
  - **Ctrl+C/Ctrl+V**でセル内容コピー＆ペースト（非編集時）
  - **Ctrl+X/Ctrl+V**でセル内容カット＆ペースト（非編集時）
  - 複数セル選択＆タブ区切りデータ対応
  - 編集中も標準ショートカット利用可
- **列幅管理**：
  - ドラッグで手動リサイズ
  - リサイズハンドルのダブルクリックで自動フィット
  - 列幅はセッション間で保持
- **データ同期**：VSCodeエディタとテーブルエディタ間でリアルタイム同期
- **IME対応**：日本語など各種入力メソッドに完全対応
- **常時表示ヘッダー**：スクロールしても行番号・列ヘッダーが固定
- **テーブル操作**：直感的なコンテキストメニューで行・列の追加/削除
- **コンテキストメニュー**：ヘッダー右クリックで精密な挿入・削除
- **シンプルUI**：ツールバー簡素化＆保存状況のスムーズな表示
- **表示専用ソート**：列ヘッダークリックでファイルを変更せずに並び替え（保存も可能）
- **ドラッグ＆ドロップ**：行・列の並び替え
- **CSVエクスポート**：テーブルデータをCSV形式で出力
- **自動保存**：変更は自動でMarkdownファイルに反映
- **複数テーブル対応**：1文書内の複数テーブルをタブインターフェースで管理・編集
- **混在コンテンツ対応**：コードブロックやリスト等と共存可能
- **堅牢なエラー処理**：下部にステータスメッセージを表示
- **テーブルインデックス管理**：複数テーブルでも正確に追跡・更新

## 使い方

### テーブルエディタの起動

1. Markdownファイルを開く
2. カーソルをテーブル内または文書内の任意の位置に置く
3. 右クリックで「Open Table Editor」またはコマンドパレット（Ctrl+Shift+P）で「Markdown Table Editor: Open Table Editor」を実行
4. **複数テーブルの場合**：
   - 全てのテーブルがwebview内でタブ表示される
   - タブをクリックして編集対象のテーブルを切り替え可能
   - VSCode側でのテーブル選択は不要

### 追加コマンド

- `Markdown Table Editor: Open Table Editor (New Panel)`：テーブルエディタを別パネルで開き、比較やマルチビューに利用できます。
- `Markdown Table Editor: Select Table Editor Theme`：Webview専用テーマを選択し、`markdownTableEditor.theme` 設定を更新します。

### 新しいテーブルの作成

1. Markdownファイルを開く
2. 右クリックで「Create New Table」またはコマンドパレットで同名コマンドを実行

### テーブル編集

- **自動セル編集**：内容やサイズに応じて入力欄が自動調整
- **複数行対応**：長文や改行を含むセルは自動でテキストエリア化
- **HTML改行タグ処理**：編集時は`<br/>`→改行、保存時は改行→`<br/>`に自動変換
- **動的サイズ調整**：入力欄は内容に応じてリサイズ
- **スマートフォーカス**：他セル選択時に自動で編集確定
- **入力改善**：クリック時のフォーカスや編集状態を最適化
- **ナビゲーション**：矢印キー、Tab、Shift+Tabでセル移動
- **行操作**：行番号右クリックで行の追加/削除
- **列操作**：ヘッダー右クリックで列の追加/削除
- **表示専用ソート**：
  - デフォルトは表示のみ変更（ファイルは未変更）
  - ソート時はインジケーター表示
  - 「📄 元に戻す」で元の順序に復元
  - 「💾 並び替えを保存」でファイルに反映
  - 数値自動判別＆正しくソート
- **ドラッグ＆ドロップ**：行・列の並び替え
- **ステータスメッセージ**：エラーや保存状況は下部に表示

## 複数テーブル・混在コンテンツ対応

### 複数テーブル
- **タブインターフェース**：複数テーブル時はwebview内でタブ表示、クリックで切り替え
- **正確な位置管理**：インデックスで各テーブルを追跡し、正確に更新
- **安全な更新**：1つのテーブル編集が他テーブルや文書内容に影響しない

### 混在コンテンツ
- **コードブロック**：コードブロック内のテーブルは無視
- **リスト・引用**：リストや引用など他要素と共存可能
- **ヘッダー・テキスト**：非テーブル部分も編集時に保持
- **行範囲の正確な特定**：高度なパースでテーブル境界を正確に判定

### エラー防止

- **バリデーション**：テーブル構造やファイル内容を厳密に検証
- **リカバリー**：エラー時は明確なメッセージと復旧手段を提示

## キーボードショートカット

### ナビゲーション（非編集時）
- **矢印キー**：セル間移動
- **Ctrl+矢印キー**：データ境界までジャンプ
- **Enter**：選択セルの編集開始
- **Tab**：次のセル/行へ
- **Shift+Tab**：前のセルへ
- **Ctrl+C / Cmd+C**：選択セルの内容コピー
- **Ctrl+V / Cmd+V**：クリップボード内容を貼り付け
- **Ctrl+X / Cmd+X**：選択セルの内容カット
- **Delete/Backspace**：選択セルの内容クリア

### 編集時
- **Enter**：編集確定＆同列の次行へ
- **Shift+Enter**：改行（編集継続）
- **Ctrl+Enter / Cmd+Enter**：編集確定＆編集終了
- **Escape**：編集確定＆編集終了
- **Tab**：編集確定＆次のセルへ
- **Ctrl+C / Cmd+C**：セル内テキストコピー
- **Ctrl+V / Cmd+V**：セル内テキスト貼り付け
- **Ctrl+X / Cmd+X**：セル内テキストカット
- **Ctrl+A / Cmd+A**：セル内全選択
- **Ctrl+Z / Cmd+Z**：セル内で元に戻す（編集モード中）
- **Ctrl+Y / Cmd+Y** または **Shift+Ctrl+Z / Shift+Cmd+Z**：セル内でやり直し（編集モード中）

### 列操作
- **リサイズハンドルのダブルクリック**：内容に自動フィット

## 必要条件

- VS Code 1.74.0 以降

## 拡張機能設定

この拡張機能は以下の設定を提供します：

* `markdownTableEditor.theme`：Webviewのテーマを選択します。`inherit` を指定すると現在のVS Codeテーマに追従します。

## 既知の問題

- 1000行を超える大きなテーブルはパフォーマンスが低下する場合あり
- 複雑なテーブル書式は編集時に簡略化される場合あり

## リリースノート

詳細な変更履歴は [CHANGELOG.md](CHANGELOG.md) を参照してください。

## 開発モード

本拡張機能の開発者向けに、HTML、CSS、JavaScriptの変更をVSCode拡張機能を再ビルドすることなくテストできる開発モードが用意されています。

### クイックスタート

1. **React Webview開発サーバーを起動:**
   ```bash
   npm run dev:webview
   ```

2. **ターミナルに表示されたViteのURL（例: `http://localhost:5173/`）を開く。**

3. **ファイルを編集:** `webview-react/src/` 配下を編集すると、Viteが自動でホットリロードします。

### 機能

- **🔄 ライブ開発**: ViteがReactコンポーネントやスタイルの変更をホットリロード
- **🎯 サンプルデータ**: VS Codeに接続していない場合でも代表的なテーブルが自動読み込み
- **🐛 デバッグしやすい**: 豊富なコンソールログとReact DevToolsによる状態確認
- **🎨 VSCodeテーマ**: VS Codeのテーマ変数を反映した見た目をブラウザで再現
- **📱 モックメッセージング**: VS Code拡張との通信を模した環境でテーブル操作を検証可能

### 開発ワークフロー

1. `npm run dev:webview` で開発サーバーを起動
2. 表示されたViteのURLをブラウザで開く
3. サンプルテーブルを操作するか、VS Codeから接続して実際のMarkdownファイルを読み込む
4. `webview-react/src/` 配下のコンポーネントやフック、スタイルを編集
5. 変更はViteが即座に反映（リセットが必要な場合のみ手動でリロード）
6. バンドルを拡張に反映したいタイミングで `npm run build-webview` を実行

### デバッグ

- ブラウザの開発者ツールやReact DevToolsで状態とログを確認
- 行・列の追加/削除、ソートなどの操作ログがコンソールに出力されます
- 必要に応じて `npm run test` を実行するか、VS Codeで拡張機能を起動してE2E動作を確認

この開発モードにより、UIと機能変更の開発サイクルが大幅に高速化されます。

## コントリビュート

本拡張機能はオープンソースです。改善提案や不具合報告を歓迎します。

## ライセンス

MIT License
