# Markdown Table Editor（日本語）

VS Code拡張機能：Markdownテーブルをスプレッドシートのようなインターフェースで編集できます。

## 🚀 クイック開発セットアップ

**この拡張機能を開発中？** HTML/CSS/JSの変更で`vsce package`サイクルをスキップ：

```bash
npm run dev
# ブラウザで http://localhost:3000/dev/ を開く
# webviewファイルを編集してリフレッシュすると即座に変更が反映！
```

> 💡 ファイル変更監視には`npm run dev:watch`を使用

## 主な機能

- **スプレッドシート風インターフェース**：グリッド表示でMarkdownテーブルを直感的に編集。ヘッダーや行番号は常に表示。
- **高度なセル編集**：自動で1行/複数行入力を切り替え、セルサイズに合わせて入力欄が調整。
- **HTML改行タグ対応**：`<br/>`タグを自動で改行に変換し、自然な編集体験。
- **Excel風ナビゲーション**：
  - 矢印キーでセル間移動
  - **Ctrl+矢印キー**でデータ境界までジャンプ
  - **Enter**でセル編集開始または次の行へ
  - **Shift+Enter**で編集中に改行
  - **Tab**で次のセルへ
- **高度なコピー/ペースト**：
  - **Ctrl+C/Ctrl+V**でセル内容コピー＆ペースト（非編集時）
  - **Ctrl+X/Ctrl+V**でセル内容カット＆ペースト（非編集時）
  - 複数セル選択＆タブ区切りデータ対応
  - 編集中も標準ショートカット利用可
- **列幅管理**：
  - ドラッグで手動リサイズ
  - リサイズハンドルのダブルクリックで自動フィット
  - 列幅はセッション間で保持
- **データ同期**：VSCodeエディタとテーブルエディタ間でリアルタイム同期
- **IME対応**：日本語など各種入力メソッドに完全対応
- **常時表示ヘッダー**：スクロールしても行番号・列ヘッダーが固定
- **テーブル操作**：直感的なコンテキストメニューで行・列の追加/削除
- **コンテキストメニュー**：ヘッダー右クリックで精密な挿入・削除
- **シンプルUI**：ツールバー簡素化＆保存状況のスムーズな表示
- **表示専用ソート**：列ヘッダークリックでファイルを変更せずに並び替え（保存も可能）
- **ドラッグ＆ドロップ**：行・列の並び替え
- **CSVエクスポート**：テーブルデータをCSV形式で出力
- **自動保存**：変更は自動でMarkdownファイルに反映
- **複数テーブル対応**：1文書内の複数テーブルをタブインターフェースで管理・編集
- **混在コンテンツ対応**：コードブロックやリスト等と共存可能
- **堅牢なエラー処理**：下部にステータスメッセージを表示
- **テーブルインデックス管理**：複数テーブルでも正確に追跡・更新

## 使い方

### テーブルエディタの起動

1. Markdownファイルを開く
2. カーソルをテーブル内または文書内の任意の位置に置く
3. 右クリックで「Open Table Editor」またはコマンドパレット（Ctrl+Shift+P）で「Markdown Table Editor: Open Table Editor」を実行
4. **複数テーブルの場合**：
   - 全てのテーブルがwebview内でタブ表示される
   - タブをクリックして編集対象のテーブルを切り替え可能
   - VSCode側でのテーブル選択は不要

### 新しいテーブルの作成

1. Markdownファイルを開く
2. 右クリックで「Create New Table」またはコマンドパレットで同名コマンドを実行

### テーブル編集

- **自動セル編集**：内容やサイズに応じて入力欄が自動調整
- **複数行対応**：長文や改行を含むセルは自動でテキストエリア化
- **HTML改行タグ処理**：編集時は`<br/>`→改行、保存時は改行→`<br/>`に自動変換
- **動的サイズ調整**：入力欄は内容に応じてリサイズ
- **スマートフォーカス**：他セル選択時に自動で編集確定
- **入力改善**：クリック時のフォーカスや編集状態を最適化
- **ナビゲーション**：矢印キー、Tab、Shift+Tabでセル移動
- **行操作**：行番号右クリックで行の追加/削除
- **列操作**：ヘッダー右クリックで列の追加/削除
- **表示専用ソート**：
  - デフォルトは表示のみ変更（ファイルは未変更）
  - ソート時はインジケーター表示
  - 「📄 元に戻す」で元の順序に復元
  - 「💾 並び替えを保存」でファイルに反映
  - 数値自動判別＆正しくソート
- **ドラッグ＆ドロップ**：行・列の並び替え
- **ステータスメッセージ**：エラーや保存状況は下部に表示

## 複数テーブル・混在コンテンツ対応

### 複数テーブル
- **タブインターフェース**：複数テーブル時はwebview内でタブ表示、クリックで切り替え
- **正確な位置管理**：インデックスで各テーブルを追跡し、正確に更新
- **安全な更新**：1つのテーブル編集が他テーブルや文書内容に影響しない

### 混在コンテンツ
- **コードブロック**：コードブロック内のテーブルは無視
- **リスト・引用**：リストや引用など他要素と共存可能
- **ヘッダー・テキスト**：非テーブル部分も編集時に保持
- **行範囲の正確な特定**：高度なパースでテーブル境界を正確に判定

### エラー防止
- **自動バックアップ**：ファイル変更前に自動バックアップ
- **バリデーション**：テーブル構造やファイル内容を厳密に検証
- **リカバリー**：エラー時は明確なメッセージと復旧手段を提示

## キーボードショートカット

### ナビゲーション（非編集時）
- **矢印キー**：セル間移動
- **Ctrl+矢印キー**：データ境界までジャンプ
- **Enter**：選択セルの編集開始
- **Tab**：次のセル/行へ
- **Shift+Tab**：前のセルへ
- **Ctrl+C / Cmd+C**：選択セルの内容コピー
- **Ctrl+V / Cmd+V**：クリップボード内容を貼り付け
- **Ctrl+X / Cmd+X**：選択セルの内容カット
- **Delete/Backspace**：選択セルの内容クリア

### 編集時
- **Enter**：編集確定＆同列の次行へ
- **Shift+Enter**：改行（編集継続）
- **Ctrl+Enter / Cmd+Enter**：編集確定＆編集終了
- **Escape**：編集確定＆編集終了
- **Tab**：編集確定＆次のセルへ
- **Ctrl+C / Cmd+C**：セル内テキストコピー
- **Ctrl+V / Cmd+V**：セル内テキスト貼り付け
- **Ctrl+X / Cmd+X**：セル内テキストカット
- **Ctrl+A / Cmd+A**：セル内全選択
- **Ctrl+Z / Cmd+Z**：セル内で元に戻す
- **Ctrl+Y / Cmd+Y**：セル内でやり直し

### 列操作
- **リサイズハンドルのダブルクリック**：内容に自動フィット

## 必要条件

- VS Code 1.74.0 以降

## 拡張機能設定

この拡張機能は以下の設定を提供します：

* `markdownTableEditor.enable`：有効/無効の切り替え

## 既知の問題

- 1000行を超える大きなテーブルはパフォーマンスが低下する場合あり
- 複雑なテーブル書式は編集時に簡略化される場合あり

## リリースノート

### 0.1.20

**データ同期＆Excel風強化**

- **リアルタイム同期**：タブ切り替え時に自動でテーブルエディタをリフレッシュ
- **スマートナビゲーション**：Excel風のCtrl+矢印キーで効率的に移動
- **日本語IME対応**：日本語入力時のEnterキー挙動を最適化
- **保存ステータス強化**：スムーズな保存状況表示
- **列幅自動調整**：リサイズハンドルのダブルクリックで自動フィット
- **スクロール位置保持**：セル操作時も位置を維持

### 0.1.19

**スマートナビゲーション＆保存表示改善**

- **Excel風ナビゲーション**：Ctrl+矢印キーでデータ境界まで移動
- **保存フィードバック改善**：保存インジケーターのスムーズな遷移
- **ユーザー体験向上**：スプレッドシートに近い直感的な操作

### 0.1.18

**日本語入力メソッド対応**

- **IME互換**：日本語など各種IMEに完全対応
- **スマートEnterキー**：IME確定と編集完了を区別
- **多言語対応**：国際ユーザー向けにキーボード処理を強化

### 0.1.17

**キーボード操作強化**

- **Excel風Enter挙動**：Enterで編集確定＆次行へ
- **Shift+Enterで改行**：直感的なテキスト入力
- **Tabナビゲーション改善**：セル遷移時の選択状態を最適化
- **列幅自動調整**：ダブルクリックで自動フィット

### 0.1.13

**キーボード操作＆UI強化**

- **キーボードナビゲーション改善**：Enterで編集開始、Escで編集確定
- **標準コピー/ペースト対応**：編集中もCtrl+C/V/X等が利用可能
- **常時表示ヘッダー**：スクロールしてもヘッダー固定
- **スプレッドシート風体験**：より直感的な操作性

### 0.1.7

**精密化＆UX向上**

- **リサイズvsソート競合修正**：リサイズ時にソートが発火しないよう修正
- **操作分離**：ヘッダードラッグで移動、リサイズハンドルで幅変更
- **セル編集改善**：入力欄クリック時の編集継続
- **イベント処理強化**：誤操作防止

### 0.1.6

**UI/UX改善＆バグ修正**

- **下部ステータスバー**：エラーや保存状況を下部に表示
- **ツールバー簡素化**：不要ボタン削除＆右クリックメニュー集約
- **フォーカス管理強化**：セル編集時のフォーカス改善
- **バグ修正**："Loading table data..."のハング問題修正
- **複数セル選択**：Ctrl/Cmd+クリックで複数セル選択

### 0.1.5

**複数テーブル＆堅牢性強化**

- **複数テーブル**：1文書内の複数テーブル対応
- **テーブル選択ダイアログ**：複数テーブル時の選択UI
- **混在コンテンツ対応**：コードブロックやリスト等と共存
- **インデックス管理**：テーブルインデックスで正確に更新
- **エラー処理強化**：自動バックアップ＆堅牢なエラー処理

### 0.1.0

初期リリース

- 基本的なテーブル編集機能
- スプレッドシート風インターフェース
- 行・列操作
- ソート＆ドラッグ＆ドロップ
- 自動保存＆バックアップ

## 開発モード

本拡張機能の開発者向けに、HTML、CSS、JavaScriptの変更をVSCode拡張機能を再ビルドすることなくテストできる開発モードが用意されています。

### クイックスタート

1. **開発サーバーを起動:**
   ```bash
   npm run dev
   ```

2. **ブラウザでアクセス:**
   ```
   http://localhost:3000/dev/
   ```

3. **ファイル編集とリフレッシュ:** `webview/`フォルダ内のファイルを編集し、ブラウザを更新するだけで変更が即座に反映されます。

### 機能

- **🔄 ライブ開発**: 拡張機能の再ビルドなしでHTML、CSS、JSファイルを編集
- **🎯 サンプルデータ**: テスト用テーブルデータが事前ロード済み
- **🐛 デバッグツール**: 組み込みデバッグユーティリティと状態確認機能
- **🎨 VSCodeテーマ**: 一貫した開発のための正確なVSCodeテーマシミュレーション
- **📱 モックAPI**: テーブル操作をテストするための完全なVSCode APIシミュレーション

### 開発ワークフロー

1. `npm run dev`で開発サーバーを起動
2. ブラウザで`http://localhost:3000/dev/`を開く
3. 開発コントロールを使用:
   - **サンプルデータドロップダウン**: Simple、Complex、Emptyテーブルテンプレートから選択
   - **Load Sample**: 選択したサンプルデータをロード
   - **Clear**: 現在のテーブルをクリア
   - **Debug State**: 現在のTableEditor状態をコンソールに出力
4. `webview/`フォルダ内のファイル（CSS、JS、HTML）を編集
5. ブラウザを更新して変更を即座に確認
6. 開発中は`vsce package`を実行する必要なし！

### デバッグ

- ブラウザの開発者ツールでコンソールログを確認
<<<<<<< HEAD
- "Debug State"ボタンでテーブルエディタの状態を検査
=======
- "Debug State"ボタンでテーブルエディタの状態を検査
>>>>>>> main
- すべてのテーブル操作（行・列の追加/削除、ソートなど）がコンソールにログ出力
- CSVエクスポート機能をブラウザで直接テスト

この開発モードにより、UIと機能変更の開発サイクルが大幅に高速化されます。

## コントリビュート

本拡張機能はオープンソースです。改善提案や不具合報告を歓迎します。

## ライセンス

MIT License
