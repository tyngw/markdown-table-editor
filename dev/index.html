<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Table Editor - Development Mode</title>

    <!-- Load the main CSS styles -->
    <link rel="stylesheet" href="/webview/style.css">

    <!-- Development-specific styles -->
    <style>
        /* VSCode theme variables for development */
        :root {
            --vscode-statusBarItem-errorForeground: #f14c4c;
            --vscode-charts-green: #89d185;
            --vscode-charts-orange: #d18616;
            --vscode-charts-red: #f14c4c;
            --vscode-foreground: #cccccc;
            --vscode-editor-background: #1e1e1e;
            --vscode-panel-border: #3c3c3c;
            --vscode-focusBorder: #007acc;
            --vscode-list-hoverBackground: #2a2d2e;
            --vscode-list-activeSelectionBackground: #094771;
            --vscode-list-activeSelectionForeground: #ffffff;
            --vscode-list-inactiveSelectionBackground: #37373d;
            --vscode-list-dropBackground: #383b3d;
            --vscode-list-focusBackground: #094771;
            --vscode-editor-lineHighlightBackground: #2a2d2e;
            --vscode-descriptionForeground: #9d9d9d;
            --vscode-font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --vscode-font-size: 14px;
            --vscode-editor-font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            --vscode-editor-font-size: 14px;
            --vscode-input-background: #3c3c3c;
            --vscode-input-foreground: #cccccc;
            --vscode-input-border: #3c3c3c;
            --vscode-inputOption-activeBorder: #007acc;
            --vscode-button-background: #0e639c;
            --vscode-button-foreground: #ffffff;
            --vscode-button-hoverBackground: #1177bb;
            --vscode-button-secondaryBackground: #3a3d41;
            --vscode-button-secondaryForeground: #cccccc;
            --vscode-button-secondaryHoverBackground: #45494e;
            --vscode-button-border: #3c3c3c;
            --vscode-dropdown-background: #3c3c3c;
            --vscode-dropdown-foreground: #cccccc;
            --vscode-dropdown-border: #3c3c3c;
            --vscode-dropdown-listBackground: #252526;
            --vscode-errorForeground: #f14c4c;
            --vscode-warningForeground: #ffcc02;
            --vscode-notificationCenterHeader-background: #2d2d30;
            --vscode-notifications-background: #2d2d30;
            --vscode-notifications-border: #303031;
            --vscode-notifications-foreground: #cccccc;
            --vscode-statusBar-background: #007acc;
            --vscode-statusBar-foreground: #ffffff;
            --vscode-statusBarItem-errorBackground: #c74e39;
            --vscode-statusBarItem-prominentForeground: #ffffff;
            --vscode-statusBarItem-warningForeground: #ffcc02;
            --vscode-statusBar-prominentForeground: #ffffff;
            --vscode-statusBarItem-errorForeground: #f14c4c;
            --vscode-charts-green: #89d185;
            --vscode-charts-orange: #d18616;
            --vscode-charts-red: #f14c4c;
            --vscode-menu-background: #252526;
            --vscode-menu-foreground: #cccccc;
            --vscode-menu-border: #454545;
            --vscode-menu-selectionBackground: #094771;
            --vscode-menu-selectionForeground: #ffffff;
            --vscode-disabledForeground: #6c6c6c;
            --vscode-menu-separatorBackground: #454545;
            --vscode-statusBar-border: #282828;
        }

        body {
            background-color: var(--vscode-editor-background);
            color: var(--vscode-foreground);
        }

        .dev-header {
            background-color: var(--vscode-notificationCenterHeader-background);
            color: var(--vscode-foreground);
            padding: 10px;
            border-bottom: 1px solid var(--vscode-panel-border);
            font-family: var(--vscode-font-family);
            font-size: 13px;
        }

        .dev-controls {
            margin: 10px 0;
        }

        .dev-button {
            background-color: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border: none;
            padding: 6px 14px;
            margin-right: 8px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 2px;
        }

        .dev-button:hover {
            background-color: var(--vscode-button-hoverBackground);
        }

        .dev-select {
            background-color: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            border: 1px solid var(--vscode-input-border);
            padding: 4px 8px;
            margin-right: 8px;
        }
    </style>

    <!-- Mock VSCode API for development -->
    <script>
        // Sample table data for development testing
        const SAMPLE_TABLES = {
            simple: {
                headers: ['Name', 'Age', 'City'],
                rows: [
                    ['John Doe', '30', 'New York'],
                    ['Jane Smith', '25', 'Los Angeles'],
                    ['Bob Johnson', '35', 'Chicago']
                ],
                metadata: {
                    tableIndex: 0,
                    startLine: 0,
                    endLine: 4
                }
            },
            complex: {
                headers: ['Feature', 'Status', 'Priority', 'Assignee', 'Due Date', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                rows: [
                    ['User Authentication', 'In Progress', 'High', 'Alice', '2024-02-15', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Dashboard Design', 'Completed', 'Medium', 'Bob', '2024-02-10', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['API Integration', 'Pending', 'High', 'Charlie', '2024-02-20', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Testing', 'Not Started', 'Low', 'David', '2024-02-25', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Login Page', 'Completed', 'High', 'Eve', '2024-02-26', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Logout Feature', 'In Progress', 'Medium', 'Frank', '2024-02-27', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Profile Update', 'Pending', 'Low', 'Grace', '2024-02-28', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Password Reset', 'Completed', 'High', 'Heidi', '2024-03-01', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Email Verification', 'In Progress', 'Medium', 'Ivan', '2024-03-02', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Notification System', 'Pending', 'Low', 'Judy', '2024-03-03', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['User Roles', 'Completed', 'High', 'Mallory', '2024-03-04', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Permission Matrix', 'In Progress', 'Medium', 'Niaj', '2024-03-05', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Audit Log', 'Pending', 'Low', 'Olivia', '2024-03-06', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Theme Switcher', 'Completed', 'High', 'Peggy', '2024-03-07', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Accessibility', 'In Progress', 'Medium', 'Quentin', '2024-03-08', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Mobile Support', 'Pending', 'Low', 'Rupert', '2024-03-09', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Export CSV', 'Completed', 'High', 'Sybil', '2024-03-10', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Import CSV', 'In Progress', 'Medium', 'Trent', '2024-03-11', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Data Sync', 'Pending', 'Low', 'Uma', '2024-03-12', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['API Rate Limit', 'Completed', 'High', 'Victor', '2024-03-13', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Session Timeout', 'In Progress', 'Medium', 'Wendy', '2024-03-14', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Multi-language', 'Pending', 'Low', 'Xavier', '2024-03-15', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Dark Mode', 'Completed', 'High', 'Yvonne', '2024-03-16', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Light Mode', 'In Progress', 'Medium', 'Zack', '2024-03-17', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Rich Text', 'Pending', 'Low', 'Alice', '2024-03-18', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Markdown Support', 'Completed', 'High', 'Bob', '2024-03-19', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['PDF Export', 'In Progress', 'Medium', 'Charlie', '2024-03-20', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Excel Export', 'Pending', 'Low', 'David', '2024-03-21', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Custom Fields', 'Completed', 'High', 'Eve', '2024-03-22', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Bulk Edit', 'In Progress', 'Medium', 'Frank', '2024-03-23', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Undo/Redo', 'Pending', 'Low', 'Grace', '2024-03-24', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Auto Save', 'Completed', 'High', 'Heidi', '2024-03-25', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Manual Save', 'In Progress', 'Medium', 'Ivan', '2024-03-26', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['History', 'Pending', 'Low', 'Judy', '2024-03-27', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Table Templates', 'Completed', 'High', 'Mallory', '2024-03-28', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Column Resize', 'In Progress', 'Medium', 'Niaj', '2024-03-29', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Row Drag', 'Pending', 'Low', 'Olivia', '2024-03-30', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Column Drag', 'Completed', 'High', 'Peggy', '2024-03-31', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Cell Merge', 'In Progress', 'Medium', 'Quentin', '2024-04-01', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Cell Split', 'Pending', 'Low', 'Rupert', '2024-04-02', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Table Copy', 'Completed', 'High', 'Sybil', '2024-04-03', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Table Paste', 'In Progress', 'Medium', 'Trent', '2024-04-04', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Table Delete', 'Pending', 'Low', 'Uma', '2024-04-05', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Table Duplicate', 'Completed', 'High', 'Victor', '2024-04-06', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Table Lock', 'In Progress', 'Medium', 'Wendy', '2024-04-07', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Table Unlock', 'Pending', 'Low', 'Xavier', '2024-04-08', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Table Import', 'Completed', 'High', 'Yvonne', '2024-04-09', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                    ['Table Export', 'In Progress', 'Medium', 'Zack', '2024-04-10', 'Extra1', 'Extra2', 'Extra3', 'Extra4'],
                ],
                metadata: {
                    tableIndex: 0,
                    startLine: 10,
                    endLine: 60
                }
            },
            empty: {
                headers: ['Column 1', 'Column 2', 'Column 3'],
                rows: [
                    ['', '', ''],
                    ['', '', '']
                ],
                metadata: {
                    tableIndex: 0,
                    startLine: 0,
                    endLine: 3
                }
            },
            multiple: [
                {
                    headers: ['Product', 'Price', 'Stock'],
                    rows: [
                        ['Laptop', '1200', '15'],
                        ['Mouse', '25', '50'],
                        ['Keyboard', '80', '30']
                    ],
                    metadata: {
                        tableIndex: 0,
                        startLine: 0,
                        endLine: 4
                    }
                },
                {
                    headers: ['Employee', 'Department', 'Salary'],
                    rows: [
                        ['Alice', 'Engineering', '90000'],
                        ['Bob', 'Marketing', '70000'],
                        ['Charlie', 'Sales', '65000']
                    ],
                    metadata: {
                        tableIndex: 1,
                        startLine: 6,
                        endLine: 10
                    }
                },
                {
                    headers: ['Task', 'Status', 'Due'],
                    rows: [
                        ['Design Review', 'Complete', '2024-01-15'],
                        ['Code Review', 'In Progress', '2024-01-20'],
                        ['Testing', 'Pending', '2024-01-25']
                    ],
                    metadata: {
                        tableIndex: 2,
                        startLine: 12,
                        endLine: 16
                    }
                }
            ]
        };

        // Mock VSCode API
        window.vscode = {
            postMessage: function (message) {
                console.log('Dev Mode - VSCode Message:', message);

                // Handle different message types for development
                switch (message.command) {
                    case 'requestTableData':
                        // Send back sample data
                        setTimeout(() => {
                            const selectedSample = document.getElementById('sampleSelect').value;
                            const sampleData = SAMPLE_TABLES[selectedSample];

                            // Handle multiple tables vs single table
                            let dataToSend;
                            if (selectedSample === 'multiple') {
                                dataToSend = sampleData; // Already an array
                            } else {
                                dataToSend = [sampleData]; // Wrap single table in array
                            }

                            window.postMessage({
                                command: 'updateTableData',
                                data: dataToSend,
                                fileInfo: {
                                    uri: 'dev://sample.md',
                                    fileName: 'sample.md',
                                    fileNameWithoutExt: 'sample'
                                }
                            }, '*');
                        }, 100);
                        break;

                    case 'updateCell':
                        console.log('üìù Cell update:', message.data);
                        // In real VSCode, this would update the file
                        break;

                    case 'addRow':
                        console.log('‚ûï Add row:', message.data);
                        break;

                    case 'deleteRow':
                        console.log('üóëÔ∏è Delete row:', message.data);
                        break;

                    case 'addColumn':
                        console.log('‚ûï Add column:', message.data);
                        break;

                    case 'deleteColumn':
                        console.log('üóëÔ∏è Delete column:', message.data);
                        break;

                    case 'exportCSV':
                        console.log('üìä Export CSV:', message.data);
                        // Download the CSV data
                        this.downloadCSV(message.data.csvData, message.data.filename);
                        break;

                    default:
                        console.log('ü§∑ Unhandled message:', message);
                }
            },

            downloadCSV: function (csvData, filename) {
                const blob = new Blob([csvData], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename || 'table-export.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }
        };

        // Listen for messages from the mock VSCode API
        window.addEventListener('message', function (event) {
            if (event.data && typeof TableEditor !== 'undefined' && TableEditor.handleVSCodeMessage) {
                TableEditor.handleVSCodeMessage(event);
            }
        });

        // Development utilities
        window.devUtils = {
            loadSample: function (sampleName) {
                document.getElementById('sampleSelect').value = sampleName;
                if (window.TableEditor && window.TableEditor.vscode) {
                    window.TableEditor.vscode.postMessage({ command: 'requestTableData' });
                }
            },

            clearTable: function () {
                if (window.TableEditor && window.TableEditor.clearTable) {
                    window.TableEditor.clearTable();
                }
            },

            debugState: function () {
                if (window.TableEditor && window.TableEditor.state) {
                    console.log('üêõ TableEditor State:', window.TableEditor.state);
                }
            }
        };

        // Set up CSS and script URIs for the webview system (same order as webviewManager.ts)
        window.cssUri = '/webview/style.css';
        window.scriptUris = [
            // Core system must be loaded first
            '/webview/js/core.js',

            // Core modules (order matters for dependencies)
            '/webview/js/error-handler.js',
            '/webview/js/vscode-communication.js',
            '/webview/js/ui-renderer.js',
            '/webview/js/table-manager.js',

            // Feature modules
            '/webview/js/table-renderer.js',
            '/webview/js/selection.js',
            '/webview/js/cell-editor.js',
            '/webview/js/sorting.js',
            '/webview/js/keyboard-navigation.js',
            '/webview/js/clipboard.js',
            '/webview/js/column-resize.js',
            '/webview/js/context-menu.js',
            '/webview/js/drag-drop.js',
            '/webview/js/status-bar.js',
            '/webview/js/csv-exporter.js'
            // '/webview/js/test-module.js'
        ];

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üöÄ Development mode initialized');
        });
    </script>
</head>

<body>
    <div class="dev-header">
        <strong>üìã Markdown Table Editor - Development Mode</strong>
        <div class="dev-controls">
            <label for="sampleSelect">Sample Data:</label>
            <select id="sampleSelect" class="dev-select">
                <option value="simple">Simple Table</option>
                <option value="complex">Complex Table</option>
                <option value="empty">Empty Table</option>
                <option value="multiple">Multiple Tables (3 tables)</option>
            </select>
            <button class="dev-button" onclick="devUtils.loadSample(document.getElementById('sampleSelect').value)">Load
                Sample</button>
            <button class="dev-button" onclick="devUtils.clearTable()">Clear</button>
            <button class="dev-button" onclick="devUtils.debugState()">Debug State</button>
        </div>
        <div style="font-size: 12px; margin-top: 5px; color: var(--vscode-descriptionForeground);">
            This is a development version for testing HTML/CSS/JS changes without rebuilding the extension.
        </div>
    </div>

    <!-- Copy the original webview structure -->
    <div id="app">
        <!-- Table tabs and content will be dynamically populated -->
    </div>

    <!-- Main table container (dynamically populated) -->
    <div id="table-container"></div>

    <!-- Sort Actions Panel -->
    <div class="sort-actions" id="sortActions" style="display: none;">
        <span class="sort-status-badge">üìä Viewing sorted data</span>
        <button class="sort-action-btn secondary"
            onclick="TableEditor.callModule('SortingManager', 'restoreOriginalView')">üìÑ Restore Original</button>
        <button class="sort-action-btn" onclick="TableEditor.callModule('SortingManager', 'commitSortToFile')">üíæ Save
            Sort to File</button>
    </div>

    <!-- Context Menus -->
    <div class="context-menu" id="rowContextMenu" style="display: none;">
        <button class="context-menu-item" onclick="TableEditor.callModule('ContextMenuManager', 'addRowAbove')">
            <span class="context-menu-item-icon">‚¨ÜÔ∏è</span>
            „Åì„ÅÆ‰∏ä„Å´Ë°å„ÇíËøΩÂä†
        </button>
        <button class="context-menu-item" onclick="TableEditor.callModule('ContextMenuManager', 'addRowBelow')">
            <span class="context-menu-item-icon">‚¨áÔ∏è</span>
            „Åì„ÅÆ‰∏ã„Å´Ë°å„ÇíËøΩÂä†
        </button>
        <div class="context-menu-separator"></div>
        <button class="context-menu-item"
            onclick="TableEditor.callModule('ContextMenuManager', 'deleteRowFromContext')">
            <span class="context-menu-item-icon">üóëÔ∏è</span>
            „Åì„ÅÆË°å„ÇíÂâäÈô§
        </button>
    </div>

    <div class="context-menu" id="columnContextMenu" style="display: none;">
        <button class="context-menu-item" onclick="TableEditor.callModule('ContextMenuManager', 'addColumnLeft')">
            <span class="context-menu-item-icon">‚¨ÖÔ∏è</span>
            „Åì„ÅÆÂ∑¶„Å´Âàó„ÇíËøΩÂä†
        </button>
        <button class="context-menu-item" onclick="TableEditor.callModule('ContextMenuManager', 'addColumnRight')">
            <span class="context-menu-item-icon">‚û°Ô∏è</span>
            „Åì„ÅÆÂè≥„Å´Âàó„ÇíËøΩÂä†
        </button>
        <div class="context-menu-separator"></div>
        <button class="context-menu-item"
            onclick="TableEditor.callModule('ContextMenuManager', 'deleteColumnFromContext')">
            <span class="context-menu-item-icon">üóëÔ∏è</span>
            „Åì„ÅÆÂàó„ÇíÂâäÈô§
        </button>
    </div>

    <!-- Load modular JavaScript files in the same order as webviewManager.ts -->
    <!-- Core system must be loaded first -->
    <script src="/webview/js/core.js"></script>

    <!-- Core modules (order matters for dependencies) -->
    <script src="/webview/js/error-handler.js"></script>
    <script src="/webview/js/vscode-communication.js"></script>
    <script src="/webview/js/ui-renderer.js"></script>
    <script src="/webview/js/table-manager.js"></script>

    <!-- Feature modules -->
    <script src="/webview/js/table-renderer.js"></script>
    <script src="/webview/js/selection.js"></script>
    <script src="/webview/js/cell-editor.js"></script>
    <script src="/webview/js/sorting.js"></script>
    <script src="/webview/js/keyboard-navigation.js"></script>
    <script src="/webview/js/clipboard.js"></script>
    <script src="/webview/js/column-resize.js"></script>
    <script src="/webview/js/context-menu.js"></script>
    <script src="/webview/js/drag-drop.js"></script>
    <script src="/webview/js/status-bar.js"></script>
    <script src="/webview/js/csv-exporter.js"></script>
    <!-- <script src="/webview/js/test-module.js"></script> -->

    <script>
        // Initialize the table editor after all modules are loaded
        if (window.TableEditor && typeof window.TableEditor.init === 'function') {
            try {
                window.TableEditor.init();
                console.log('‚úÖ TableEditor initialized successfully');

                // Auto-load the first sample
                setTimeout(() => {
                    devUtils.loadSample('simple');
                }, 500);
            } catch (error) {
                console.error('‚ùå Error initializing TableEditor:', error);
            }
        } else {
            console.error('‚ùå TableEditor object not found');
        }
    </script>
</body>

</html>